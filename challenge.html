<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Challenges</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <h1 id="userGreeting">Welcome, Challenger! ðŸŒ±</h1>
      <p id="userGoal">Your Goal: Loading...</p>
      <p id="userExperience">Experience Level: Loading...</p>
    </header>

    <h2>Today's Challenges:</h2>
    <ul id="challengeList"></ul>

    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        // Get user details from localStorage
        const userName = localStorage.getItem("userName") || "Challenger";
        const goal = localStorage.getItem("goal") || "random";
        const experience = localStorage.getItem("level") || "beginner";

        // Display user info
        document.getElementById(
          "userGreeting"
        ).textContent = `Welcome, ${userName}! ðŸŒ±`;
        document.getElementById(
          "userGoal"
        ).textContent = `Your Goal: ${goal.replace("-", " ")}`;
        document.getElementById(
          "userExperience"
        ).textContent = `Experience Level: ${
          experience.charAt(0).toUpperCase() + experience.slice(1)
        }`;

        // Fetch challenges from MongoDB through API
        try {
          const response = await fetch(
            `http://localhost:5501/api/challenges?goal=${goal}&level=${experience}`
          );
          const challenges = await response.json();

          const challengeList = document.getElementById("challengeList");
          challengeList.innerHTML = ""; // Clear previous items

          // Loop through challenges and display them
          challenges.forEach((challenge) => {
            const li = document.createElement("li");
            li.innerHTML = `<input type="checkbox" class="task-checkbox"> ${challenge}`;
            challengeList.appendChild(li);
          });
        } catch (error) {
          console.error("Error fetching challenges:", error);
          document.getElementById(
            "challengeList"
          ).innerHTML = `<p>Failed to load challenges.</p>`;
        }
      });
    </script>
  </body>
</html>
